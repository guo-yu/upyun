!function(t,n,e){"use strict";function r(t){this.events={},this.configs=t&&t.configs?t.configs:o()}function i(t){var e=this;this.configs=t,this.config=function(t){return t&&n.isObject(t)?(n.forEach(t,function(t,n){a.indexOf(n)>-1?e.configs[n]=t:e.configs.params[n]=t}),this.configs):void 0},this.$get=[function(){return new r(e)}]}function o(){return{form_api_secret:"",params:{expiration:(new Date).getTime()+60,"save-key":"/{year}/{mon}/{day}/upload_{filemd5}{.suffix}","allow-file-type":"jpg,jpeg,gif,png"}}}var s=e&&e.start&&e.done,a=["signature","policy","form_api_secret","endpoint","host"];n?n.module("upyun",[]).constant("UPYUN_CONFIGS",o()).provider("upyun",["UPYUN_CONFIGS",i]):t.upyun=new r,r.prototype.set=function(t,n){return t&&n&&(a.indexOf(t)>-1?this.configs[t]=n:this.configs.params[t]=n),this},r.prototype.on=function(t,n){return t&&n&&(this.events[t]=n),this},r.prototype.upload=function(n,r){if(!t.JSON)throw new Error("JSON is required.");if(!t.FormData)throw new Error("FormData is required.");if(!t.XMLHttpRequest)throw new Error("XMLHttpRequest is required.");if(!r||"function"!=typeof r)throw new Error("Callback function is required.");var i=this,o=new XMLHttpRequest,a="string"==typeof n,u=a?new FormData(document.forms.namedItem(n)):new FormData;if(!i.configs.policy&&!t.Base64)throw new Error("lib Base64 is required");if(!i.configs.signature&&!t.md5)throw new Error("lib Md5 is required");var f=i.configs.policy||t.Base64.encode(JSON.stringify(i.configs.params)),p=i.configs.endpoint||"http://v0.api.upyun.com/"+i.configs.params.bucket,c=i.configs.host||"http://"+i.configs.params.bucket+".b0.upaiyun.com";a||u.append("file",n),u.append("policy",f),u.append("signature",i.configs.signature||t.md5(f+"&"+i.configs.form_api_secret)),o.open("POST",p,!0),o.addEventListener("error",function(t){return r(t)},!1),o.addEventListener("load",function(t){s&&e.done();var n=t.target.status;if(200!==n)return r(new Error(t.target.status),t.target);try{var i=JSON.parse(this.responseText);return i.absUrl=c+i.url,i.absUri=i.absUrl,r(null,t.target,i)}catch(o){return r(o)}},!1),o.upload.addEventListener("progress",function(t){t.lengthComputable&&i.events.uploading&&"function"==typeof i.events.uploading&&i.events.uploading(Math.round(t.loaded/t.total*100))}),o.send(u),s&&e.start()}}(window,window.angular,window.NProgress);
//# sourceMappingURL=upyun.min.js.map