!function(t,e,n){"use strict";function r(t,e,n){var r=n&&n.configs;this.base64=t,this.md5=e,this.events={},this.configs=r?n.configs:o()}function i(t){var n=this;this.configs=t,this.config=function(t){return t&&e.isObject(t)?(e.forEach(t,function(t,e){a.indexOf(e)>-1?n.configs[e]=t:n.configs.params[e]=t}),this.configs):void 0},this.$get=["$base64","md5",function(t,e){return new r(t,e,n)}]}function o(){return{form_api_secret:"",params:{expiration:(new Date).getTime()+60,"save-key":"/{year}/{mon}/{day}/upload_{filemd5}{.suffix}","allow-file-type":"jpg,jpeg,gif,png"}}}var s=n&&n.start&&n.done,a=["signature","policy","form_api_secret","endpoint","host"];e?e.module("upyun",["base64","angular-md5"]).constant("UPYUN_CONFIGS",o()).provider("upyun",["UPYUN_CONFIGS",i]):t.upyun=new r(t.Base64,t.md5),r.prototype.set=function(t,e){return t&&e&&(a.indexOf(t)>-1?this.configs[t]=e:this.configs.params[t]=e),this},r.prototype.on=function(t,e){return t&&e&&(this.events[t]=e),this},r.prototype.upload=function(e,r){if(!this.base64)throw new Error("base64 required.");if(!this.md5)throw new Error("md5 required.");if(!t.JSON)throw new Error("JSON required.");if(!t.FormData)throw new Error("FormData required.");if(!t.XMLHttpRequest)throw new Error("XMLHttpRequest required.");if(!r||"function"!=typeof r)throw new Error("callback function required.");var i=this,o=new XMLHttpRequest,a="string"==typeof e,u=i.md5.createHash||i.md5,f=a?new FormData(document.forms.namedItem(e)):new FormData,p=i.configs.policy||i.base64.encode(JSON.stringify(i.configs.params)),c=i.configs.endpoint||"http://v0.api.upyun.com/"+i.configs.params.bucket,d=i.configs.host||"http://"+i.configs.params.bucket+".b0.upaiyun.com";a||f.append("file",e),f.append("policy",p),f.append("signature",i.configs.signature||u(p+"&"+i.configs.form_api_secret)),o.open("POST",c,!0),o.addEventListener("error",function(t){return r(t)},!1),o.addEventListener("load",function(t){s&&n.done();var e=t.target.status;if(200!==e)return r(new Error(t.target.status),t.target);try{var i=JSON.parse(this.responseText);return i.absUrl=d+i.url,i.absUri=i.absUrl,r(null,t.target,i)}catch(o){return r(o)}},!1),o.upload.addEventListener("progress",function(t){t.lengthComputable&&i.events.uploading&&"function"==typeof i.events.uploading&&i.events.uploading(Math.round(t.loaded/t.total*100))}),o.send(f),s&&n.start()}}(window,window.angular,window.NProgress);
//# sourceMappingURL=upyun.min.js.map