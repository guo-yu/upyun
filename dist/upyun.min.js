!function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error("base64 required.");if(!t)throw new Error("md5 required.");this.base64=e,this.md5=t,this.events={},this.form_api_secret="",this.configs={},this.configs.expiration=(new Date).getTime()+60,this.configs["save-key"]="/{year}/{mon}/{day}/upload_{filemd5}{.suffix}",this.configs["allow-file-type"]="jpg,jpeg,gif,png"}var o=r&&r.start&&r.done;t?t.module("upyun",["base64","angular-md5"]).service("$upyun",["$base64","md5",n]):e.upyun=new n(e.Base64,e.md5),n.prototype.set=function(e,t){var r=["form_api_secret","endpoint","host"];return e&&t&&(r.indexOf(e)>-1?this[e]=t:this.configs[e]=t),this},n.prototype.on=function(e,t){return e&&t&&(this.events[e]=t),this},n.prototype.upload=function(t,n){if(!e.JSON)throw new Error("JSON required.");if(!e.FormData)throw new Error("FormData required.");if(!e.XMLHttpRequest)throw new Error("XMLHttpRequest required.");if(!n||"function"!=typeof n)throw new Error("callback function required.");var i=this,s=new XMLHttpRequest,a="string"==typeof t,u=i.md5.createHash||i.md5,p=a?new FormData(document.forms.namedItem(t)):new FormData,d=i.base64.encode(JSON.stringify(i.configs)),f=i.endpoint||"http://v0.api.upyun.com/"+i.configs.bucket,c=i.host||"http://"+i.configs.bucket+".b0.upaiyun.com";a||p.append("file",t),p.append("policy",d),p.append("signature",u(d+"&"+i.form_api_secret)),s.open("POST",f,!0),s.addEventListener("error",function(e){return n(e)},!1),s.addEventListener("load",function(e){o&&r.done();var t=e.target.status;if(200!==t)return n(new Error(e.target.status),e.target);try{var i=JSON.parse(this.responseText);return i.absUrl=c+i.url,i.absUri=i.absUrl,n(null,e.target,i)}catch(s){return n(s)}},!1),s.upload.addEventListener("progress",function(e){e.lengthComputable&&i.events.uploading&&"function"==typeof i.events.uploading&&i.events.uploading(Math.round(e.loaded/e.total*100))}),s.send(p),o&&r.start()}}(window,window.angular,window.NProgress);
//# sourceMappingURL=upyun.min.js.map