!function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error("base64 required.");if(!t)throw new Error("md5 required.");this.base64=e,this.md5=t,this.events={},this.form_api_secret="",this.configs={},this.configs.expiration=(new Date).getTime()+60,this.configs["save-key"]="/{year}/{mon}/{day}/upload_{filemd5}{.suffix}",this.configs["allow-file-type"]="jpg,jpeg,gif,png"}if(!e.JSON)throw new Error("JSON required.");if(!e.FormData)throw new Error("FormData required.");if(!e.XMLHttpRequest)throw new Error("XMLHttpRequest required.");var o=r&&r.start&&r.done;t?t.module("upyun",["base64","angular-md5"]).service("$upyun",["$base64","md5",n]):e.upyun=new n(e.Base64,e.md5),n.prototype.set=function(e,t){var r=["form_api_secret","endpoint","host"];return e&&t&&(r.indexOf(e)>-1?this[e]=t:this.configs[e]=t),this},n.prototype.on=function(e,t){return e&&t&&(this.events[e]=t),this},n.prototype.upload=function(e,t){if(!t||"function"!=typeof t)throw new Error("callback function required.");var n=this,i=new XMLHttpRequest,s="string"==typeof e,a=n.md5.createHash||n.md5,u=s?new FormData(document.forms.namedItem(e)):new FormData,p=n.base64.encode(JSON.stringify(n.configs)),d=n.endpoint||"http://v0.api.upyun.com/"+n.configs.bucket,f=n.host||"http://"+n.configs.bucket+".b0.upaiyun.com";s||u.append("file",e),u.append("policy",p),u.append("signature",a(p+"&"+n.form_api_secret)),i.open("POST",d,!0),i.addEventListener("error",function(e){return t(e)},!1),i.addEventListener("load",function(e){o&&r.done();var n=e.target.status;if(200!==n)return t(new Error(e.target.status),e.target);try{var i=JSON.parse(this.responseText);return i.absUrl=f+i.url,i.absUri=i.absUrl,t(null,e.target,i)}catch(s){return t(s)}},!1),i.upload.addEventListener("progress",function(e){e.lengthComputable&&n.events.uploading&&"function"==typeof n.events.uploading&&n.events.uploading(Math.round(e.loaded/e.total*100))}),i.send(u),o&&r.start()}}(window,window.angular,window.NProgress);
//# sourceMappingURL=upyun.min.js.map