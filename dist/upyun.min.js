!function(t,e,n){"use strict";function r(t,e,n){var r=n&&n.configs;this.base64=t,this.md5=e,this.events={},this.configs=r?n.configs:i()}function o(t){var n=this;this.configs=t,this.config=function(t){if(t&&e.isObject(t)){var r=["form_api_secret","endpoint","host"];return e.forEach(t,function(t,e){r.indexOf(e)>-1?n.configs[e]=t:n.configs.params[e]=t}),this.configs}},this.$get=["$base64","md5",function(t,e){return new r(t,e,n)}]}function i(){return{form_api_secret:"",params:{expiration:(new Date).getTime()+60,"save-key":"/{year}/{mon}/{day}/upload_{filemd5}{.suffix}","allow-file-type":"jpg,jpeg,gif,png"}}}var s=n&&n.start&&n.done;e?e.module("upyun",["base64","angular-md5"]).constant("UPYUN_CONFIGS",i()).provider("upyun",["UPYUN_CONFIGS",o]):t.upyun=new r(t.Base64,t.md5),r.prototype.set=function(t,e){var n=["form_api_secret","endpoint","host"];return t&&e&&(n.indexOf(t)>-1?this.configs[t]=e:this.configs.params[t]=e),this},r.prototype.on=function(t,e){return t&&e&&(this.events[t]=e),this},r.prototype.upload=function(e,r){if(!this.base64)throw new Error("base64 required.");if(!this.md5)throw new Error("md5 required.");if(!t.JSON)throw new Error("JSON required.");if(!t.FormData)throw new Error("FormData required.");if(!t.XMLHttpRequest)throw new Error("XMLHttpRequest required.");if(!r||"function"!=typeof r)throw new Error("callback function required.");var o=this,i=new XMLHttpRequest,a="string"==typeof e,u=o.md5.createHash||o.md5,f=a?new FormData(document.forms.namedItem(e)):new FormData,p=o.base64.encode(JSON.stringify(o.configs.params)),c=o.configs.endpoint||"http://v0.api.upyun.com/"+o.configs.params.bucket,d=o.configs.host||"http://"+o.configs.params.bucket+".b0.upaiyun.com";a||f.append("file",e),f.append("policy",p),f.append("signature",u(p+"&"+o.configs.form_api_secret)),i.open("POST",c,!0),i.addEventListener("error",function(t){return r(t)},!1),i.addEventListener("load",function(t){s&&n.done();var e=t.target.status;if(200!==e)return r(new Error(t.target.status),t.target);try{var o=JSON.parse(this.responseText);return o.absUrl=d+o.url,o.absUri=o.absUrl,r(null,t.target,o)}catch(i){return r(i)}},!1),i.upload.addEventListener("progress",function(t){t.lengthComputable&&o.events.uploading&&"function"==typeof o.events.uploading&&o.events.uploading(Math.round(t.loaded/t.total*100))}),i.send(f),s&&n.start()}}(window,window.angular,window.NProgress);
//# sourceMappingURL=upyun.min.js.map